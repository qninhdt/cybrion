<p align="center">
    <img width="100" src="./docs/icon.png" alt="Cybrion">
    <h1 align="center">Cybrion</h1>
    <p align="center"><i>â Just a silly blocky game â â€” <b>@qninhdt</b></i></p>
</p>


<p align="center">
    <img src="./docs/screenshots/preview.png" alt="Cybrion preview">
</p>

## âœï¸ MÃ´ táº£

__Cybrion__ lÃ  má»™t trÃ² chÆ¡i 3D Ä‘Æ°á»£c viáº¿t báº±ng ngÃ´n ngá»¯ C++ phiÃªn báº£n 20 vÃ  sá»­ dá»¥ng thÆ° viá»‡n SDL2 Ä‘á»ƒ xá»­ lÃ½ Ä‘á»“ há»a. Trong Cybrion, ngÆ°á»i chÆ¡i sáº½ Ä‘Æ°á»£c thá»a thÃ­ch xÃ¢y dá»±ng báº¥t cá»© thá»© gÃ¬ báº±ng nhá»¯ng khá»‘i cÃ³ sáºµn, trong má»™t tháº¿ giá»›i má»Ÿ tuyá»‡t Ä‘áº¹p, khÃ´ng bá»‹ giá»›i háº¡n bá»Ÿi khÃ´ng gian.

## ğŸ’¡ TÃ­nh nÄƒng

- Tháº¿ giá»›i má»Ÿ, rá»™ng vÃ´ háº¡n
- Nhiá»u loáº¡i khá»‘i nhÆ° gá»—, Ä‘áº¥t, Ä‘Ã¡, xi mÄƒng. Nhiá»u loáº¡i hoa vÃ  loáº¡i cÃ¢y
- Sá»­ dá»¥ng Ä‘a luá»“ng Ä‘á»ƒ sinh tháº¿ giá»›i, giÃºp tÄƒng hiá»‡u suáº¥t trÃ² chÆ¡i
- CÃ³ thá»ƒ lÆ°u vÃ  má»Ÿ tháº¿ giá»›i Ä‘á»ƒ chia sáº» vá»›i báº¡n bÃ¨
- Giao diá»‡n, Ä‘á»“ há»a báº¯t máº¯t, dá»… dÃ¹ng

## ğŸ® HÆ°á»›ng dáº«n chÆ¡i

### Hello world

- __BÆ°á»›c 1__: Nháº­p tÃªn tháº¿ giá»›i muá»‘n táº¡o rá»“i áº¥n nÃºt `Create`
- __BÆ°á»›c 2__: Nháº¥n nÃºt `Play` á»Ÿ tháº¿ giá»›i vá»«a táº¡o
- __BÆ°á»›c 3__: Enjoy the game ğŸ—¿ğŸ·

### Äiá»u khiá»ƒn

- __`Chuá»™t trÃ¡i`__ : phÃ¡ khá»‘i
- __`Chuá»™t pháº£i`__ : Ä‘áº·t khá»‘i
- __`WASD`__ : di chuyá»ƒn
- __`Space`__ : bay lÃªn
- __`Shift`__ : háº¡ xuá»‘ng
- __`E`__ : má»Ÿ tÃºi Ä‘á»“ vÃ  chá»n khá»‘i
- __`Esc`__ : táº¡m dá»«ng
- __`Ctrl`__ : di chuyá»ƒn nhanh hÆ¡n
- __`F1`__ : áº©n GUI
- __`F3`__ : má»Ÿ cÃ´ng cá»¥ debug

## ğŸ–¼ï¸ Preview

- Loading . . .


## ğŸ”§ BiÃªn dá»‹ch mÃ£ nguá»“n
### Windows
#### Pháº§n má»m yÃªu cáº§u:
- [Git](https://git-scm.com/)
- [CMake](https://cmake.org/)
- [Visual Studio 2015 hoáº·c cao hÆ¡n](https://visualstudio.microsoft.com/)

> _ThÃªm CMake vÃ o biáº¿n mÃ´i trÆ°á»ng (environment variables)_
#### Táº£i thÆ° viá»‡n vÃ  biÃªn dá»‹ch
- __BÆ°á»›c 1__: Má»Ÿ cá»­a sá»• cmd rá»“i táº£i mÃ£ nguá»“n tá»« Github
```batch
> git clone https://github.com/qninhdt/cybrion
```
- __BÆ°á»›c 2__: Táº£i vcpkg vÃ  thÆ° viá»‡n
```batch
> cd cybrion
> build.bat
```
- __Step 3__: Cháº¡y láº¡i file `build.bat` Ä‘á»ƒ biÃªn dá»‹ch
```batch
> build.bat
```

Sau khi biÃªn dá»‹ch, cÃ¡c file cáº§n thiáº¿t cho game sáº½ xuáº¥t hiá»‡n trong thÆ° má»¥c `cybrion/build`

Cháº¡y file `cybrion.exe` trong thÆ° má»¥c trÃªn Ä‘á»ƒ chÆ¡i game  

### Linux
#### Pháº§n má»m yÃªu cáº§u
- [Git](https://git-scm.com/)
#### Táº£i thÆ° viá»‡n vÃ  biÃªn dá»‹ch
- __BÆ°á»›c 1__: Táº£i mÃ£ nguá»“n tá»« Github
```bash
$ git clone https://github.com/qninhdt/cybrion
```
- __BÆ°á»›c 2__: Cháº¡y `build.sh` Ä‘á»ƒ tá»± Ä‘á»™ng táº£i thÆ° viá»‡n, pháº§n má»m cáº§n thiáº¿t vÃ  biÃªn dá»‹ch mÃ£ nguá»“n
```bash
$ cd cybrion
$ ./build.sh
```

TÆ°Æ¡ng tá»± nhÆ° trÃªn __Windows__  thÆ° má»¥c chÆ°a game lÃ  `cybrion/build`

## ğŸ“ Cáº¥u trÃºc mÃ£ nguá»“n

    â”œâ”€â”€ resources           # Chá»©a texture cá»§a game, file cáº¥u hÃ¬nh, file shader, ...
    â””â”€â”€ src                 # MÃ£ nguá»“n
    |   â”œâ”€â”€ client              # Chá»©a má»i thá»© liÃªn quan Ä‘áº¿n cá»­a sá»•, Ä‘iá»u khiá»ƒn, render          
    |   |   â”œâ”€â”€ GL                  # Xá»­ lÃ½ OpenGL (mesh, framebuffer, texture, ...)
    |   |   â”œâ”€â”€ graphic             # Xá»­ lÃ½ render khá»‘i, tháº¿ giá»›i, báº§u trá»i
    |   |   â”œâ”€â”€ resource            # Äá»c file cáº¥u hÃ¬nh, file shader, táº£i texture, ...
    |   |   â””â”€â”€ ui                  # Xá»­ lÃ½ giao diá»‡n (inventory, menu, text, ...)
    |   â”œâ”€â”€ core                # Chá»©a má»™t vÃ i cáº¥u trÃºc dá»¯ liá»‡u quan trá»ng
    |   â”œâ”€â”€ physic              # Xá»­ lÃ½ váº­t lÃ½ (AABB)
    |   â”œâ”€â”€ uitl                # Má»™t sá»‘ hÃ m há»— trá»£
    |   â”œâ”€â”€ world               # Quáº£n lÃ½ tháº¿ giá»›i, khá»‘i vÃ  ngÆ°á»i chÆ¡i
    |   â””â”€â”€ ...
    â””â”€â”€ ...

## ğŸ’» Thuáº­t toÃ¡n cá»§a trÃ² chÆ¡i

### Tá»•ng quan

- Tháº¿ giá»›i trong Cybrion Ä‘Æ°á»£c chia thÃ nh cÃ¡c chunk. Má»—i chunk cÃ³ cáº¥u táº¡o tá»« 32x32x32 khá»‘i. Tháº¿ giá»›i sáº½ lÆ°u trá»¯ cÃ¡c chunk dÆ°á»›i dáº¡ng map vá»›i key lÃ  1 vector 3D gá»“m tá»a Ä‘á»™ x, y, z cá»§a chunk. (TÆ°Æ¡ng tá»± nhÆ° trong Minecraft, má»—i chunk cÃ³ kÃ­ch cá»¡ 16x256x16)
- Nhá» viá»‡c lÆ°u trá»¯ chunk báº±ng map thay vÃ¬ máº£ng cá»‘ Ä‘á»‹nh hay vector mÃ  tháº¿ giá»›i cÃ³ thá»ƒ rá»™ng vÃ´ háº¡n.
- Má»—i chunk chá»‰ Ä‘Æ°á»£c táº¡o hoáº·c Ä‘á»c tá»« bá»™ nhá»› khi cÃ¡ch ngÆ°á»i chÆ¡i má»™t khoáº£ng nháº¥t Ä‘á»‹nh.
- Sá»­ dá»¥ng thuáº­t toÃ¡n Perlin Noise Ä‘á»ƒ sinh tháº¿ :
  - Dá»±a vÃ o tá»a Ä‘á»™ vÃ  má»™t seed ( seed Ä‘Æ°á»£c táº¡o ngáº«u nhiÃªn tá»« khi táº¡o tháº¿ giá»›i ) Ä‘á»ƒ táº¡o ra má»™t áº£nh noise (hÃ¬nh 1)
  - Tá»« áº£nh noise, trÃ² chÆ¡i sáº½ sinh ra height map Ä‘á»ƒ phá»¥c vá»¥ cho viá»‡c sinh tháº¿ giá»›i (hÃ¬nh 2)
  - Tiáº¿p theo ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c yáº¿u tá»‘ khÃ¡c nhÆ° Ä‘á»™ cao Ä‘á»ƒ lá»±a chá»n khá»‘i Ä‘á»ƒ Ä‘áº·t
  - _Äá»c thÃªm: [Making maps with noise functions (redblobgames.com)](https://www.redblobgames.com/maps/terrain-from-noise/)_

 

<p align="center">
    <img src="./docs/perlin_noise_2.png" width="256px" />
    <img src="./docs/perlin_noise_1.png" width="256px" />
</p>



- Äá»ƒ thuáº­n tiá»‡n cho quÃ¡ trÃ¬nh lÆ°u trá»¯ thÃ¬ má»—i block Ä‘Æ°á»£c cáº¥p phÃ¡t má»™t ID duy nháº¥t cÃ³ giÃ¡ trá»‹ nguyÃªn dÆ°Æ¡ng. VÃ­ dá»¥: id(AIR) == 0, id(DIRT) == 5, id(SAND) == 17, ...

### KhÃ³ khÄƒn

- __Tháº¿ giá»›i yÃªu cáº§u bá»™ nhá»› quÃ¡ lá»›n__

  - Máº·c dÃ¹ má»—i block cÃ³ thá»ƒ lÆ°u trá»¯ dÆ°á»›i dáº¡ng 1 sá»‘ nguyÃªn tuy nhiÃªn sá»‘ lÆ°á»£ng block trong tháº¿ giá»›i lÃ  vÃ´ cÃ¹ng lá»›n

  - Vá»›i táº§m nhÃ¬n lÃ  8 (máº·c Ä‘á»‹nh cá»§a trÃ² chÆ¡i) thÃ¬ sá»‘ chunk cáº§n lÆ°u trá»¯ â‰ˆ 1700 chunk = 1700 x 32 x 32 x 32 = **55,705,600** block
  - Náº¿u trÃ² chÆ¡i cá»§a ta cÃ³ hÆ¡n 256 loáº¡i block thÃ¬ ta cáº§n 2 byte cho má»—i block => bá»™ nhá»› cáº§n dÃ¹ng â‰ˆ 100Mb
  - Váº­y chá»‰ sau 10 phÃºt di chuyá»ƒn, khÃ¡m phÃ¡ trÃ² chÆ¡i thÃ¬ bá»™ nhá»› cáº§n dÃ¹ng Ä‘á»ƒ lÆ°u trá»¯ tháº¿ giá»›i cÃ³ thá»ƒ lÃªn tá»›i vÃ i Gb (uy tÃ­n)
- __Tá»‘n quÃ¡ nhiá»u thá»i gian Ä‘á»ƒ render__

  - TÆ°Æ¡ng tá»± nhÆ° váº¥n Ä‘á» trÃªn, viá»‡c cÃ³ quÃ¡ nhiá»u khá»‘i tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i cÃ³ quÃ¡ nhiá»u váº­t thá»ƒ cáº§n Ä‘Æ°á»£c render.
  - Sá»‘ block cáº§n váº½ lÃ  **55,705,600** block, má»—i block láº¡i cÃ³ 6 máº·t => sá»‘ hÃ¬nh chá»¯ nháº­t cáº§n váº½ lÃ  **334,233,600** hÃ¬nh !
- __KhÃ´ng cÃ³ cÃ¡ch lÆ°u trá»¯ phÃ¹ há»£p__:

  - File text, json: Tá»‘n bá»™ nhá»›, tá»‘c Ä‘á»™ Ä‘á»c ráº¥t kÃ©m
  - Database: khÃ´ng phÃ¹ há»£p, quÃ¡ phá»©c táº¡p

### CÃ¡ch giáº£i quyáº¿t

- __Sá»­ dá»¥ng cáº¥u trÃºc dá»¯ liá»‡u Palette__:

  - Do trong má»—i chunk chá»§ yáº¿u chá»‰ cÃ³ tá»« 3 - 10 loáº¡i block khÃ¡c nhau nÃªn viá»‡c sá»­ dá»¥ng 2 byte tÆ°Æ¡ng á»©ng vá»›i 65536 giÃ¡ trá»‹ khÃ¡c nhau lÃ  ráº¥t lÃ£ng phÃ­. 

  - Palette lÃ  má»™t cáº¥u trÃºc dá»¯ liá»‡u tá»± Ä‘á»™ng Ä‘iá»u chá»‰nh bá»™ nhá»› tÃ¹y thuá»™c vÃ o sá»‘ block khÃ¡c nhau trong chunk, táº­n dá»¥ng triá»‡t Ä‘á»ƒ tá»«ng bit trong má»™t byte Ä‘á»ƒ lÆ°u trá»¯

    | Sá»‘ block khÃ¡c nhau trong 1 chunk |   Tá»‰ lá»‡   | Sá»‘ bit má»—i block | KÃ­ch cá»¡ chunk |
    | :------------------------------: | :-------: | :--------------: | :-----------: |
    |              1 - 2               |    Ãt     |        1         |      4Kb      |
    |              3 - 4               | Ráº¥t nhiá»u |        2         |      8Kb      |
    |              5 - 16              |   Nhiá»u   |        4         |     16Kb      |
    |             17 - 256             |   Hiáº¿m    |        8         |     32Kb      |
    |           257 - 65536            | KhÃ´ng cÃ³  |        16        |     64Kb      |

- __Sá»­ dá»¥ng file JBT Ä‘á»ƒ lÆ°u trá»¯ tháº¿ giá»›i__:

  - [JBT](https://github.com/qninhdt/jbt) hay "JSON-like binary tag" lÃ  má»™t kiá»ƒu file lÆ°u trá»¯ dá»¯ liá»‡u dÆ°á»›i dáº¡ng nhá»‹ phÃ¢n Ä‘Æ°á»£c mÃ¬nh phÃ¡t triá»ƒn nháº±m má»¥c Ä‘Ã­ch vá»«a táº­n dá»¥ng sá»± dá»… hiá»ƒu cá»§a json mÃ  vá»«a cÃ³ thá»ƒ lÆ°u trá»¯ Ä‘Æ°á»£c dá»¯ liá»‡u lá»›n
  - JBT sáº½ lÆ°u chunk thÃ nh 1 region file cÃ³ Ä‘uÃ´i .hjbt. Má»™t region sáº½ chá»©a tá»‘i Ä‘a 32x32x32 chunk, tuy nhiÃªn file nÃ y chá»‰ lÆ°u trá»¯ nhá»¯ng chunk Ä‘Ã£ Ä‘Æ°á»£c sinh ra
  - NgoÃ i ra JBT cÃ²n sá»­ dá»¥ng thuáº­t toÃ¡n [lz4](https://github.com/lz4/lz4) Ä‘á»ƒ nÃ©n dá»¯ liá»‡u trÆ°á»›c khi lÆ°u
  
- __Chá»‰ render nhá»¯ng block cÃ³ thá»ƒ nhÃ¬n tháº¥y__:

  - Ta áº©n nhá»¯ng block mÃ  6 máº·t xung quanh Ä‘á»u cÃ³ block vÃ¬ nÃ³ cháº¯c cháº¯n khÃ´ng tháº¿ nhÃ¬n tháº¥y
  - Nhá» cÃ¡ch nÃ y mÃ  ta cÃ³ thá»ƒ giáº£m Ä‘Ã¡ng ká»ƒ sá»‘ block pháº£i render tá»« *O*(nÂ³) xuá»‘ng *O*(nÂ²)


<p align="center">
    <img src="./docs/stupid_meshing.png" height="128px" />
    <img src="./docs/culled_meshing.png" height="128px" />
</p>



## ğŸ“¦ThÆ° viá»‡n

- [SDL2](https://github.com/libsdl-org/SDL) - Xá»­ lÃ½ mÃ n hÃ¬nh vÃ  Ä‘iá»u khiá»ƒn
- [glad](https://github.com/Dav1dde/glad)- Xá»­ lÃ½ Ä‘á»“ há»a
- [irrKlang](https://www.ambiera.com/irrklang/) - Xá»­ lÃ½ Ã¢m thanh
- [glm](https://github.com/g-truc/glm) - TÃ­nh toÃ¡n ma tráº­n vÃ  vector
- [FastNoiseLite](https://github.com/Auburn/FastNoiseLite) - Táº¡o height map Ä‘á»ƒ sinh tháº¿ giá»›i
- [imgui](https://github.com/ocornut/imgui) - Táº¡o giao diá»‡n ngÆ°á»i dÃ¹ng
- [spdlog](https://github.com/gabime/spdlog) - Logging
- [yaml-cpp](https://github.com/jbeder/yaml-cpp) - Äá»c file yaml
- [thread-pool](https://github.com/bshoshany/thread-pool) - Xá»­ lÃ½ Ä‘a luá»“ng
- [concurrentqueue](https://github.com/cameron314/concurrentqueue) - Thread-safe queue

## ğŸŒŸCredit

- __Texture pack:__ [Jolicraft ](http://jolicraft.com/)
- __Sound:__ : Minecraft
- __Font__: Minecraft



